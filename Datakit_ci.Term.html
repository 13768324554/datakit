<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="Start" href="index.html">
<link rel="previous" href="Datakit_ci.Target.html">
<link rel="next" href="Datakit_ci.ACL.html">
<link rel="Up" href="Datakit_ci.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Index of module types" rel=Appendix href="index_module_types.html">
<link title="Vfs" rel="Chapter" href="Vfs.html">
<link title="Fs9p" rel="Chapter" href="Fs9p.html">
<link title="Datakit_path" rel="Chapter" href="Datakit_path.html">
<link title="Datakit_S" rel="Chapter" href="Datakit_S.html">
<link title="Datakit_client_9p" rel="Chapter" href="Datakit_client_9p.html">
<link title="Ivfs" rel="Chapter" href="Ivfs.html">
<link title="Ivfs_tree" rel="Chapter" href="Ivfs_tree.html">
<link title="Ivfs_remote" rel="Chapter" href="Ivfs_remote.html">
<link title="Ivfs_blob" rel="Chapter" href="Ivfs_blob.html">
<link title="Datakit_github" rel="Chapter" href="Datakit_github.html">
<link title="Datakit_github_api" rel="Chapter" href="Datakit_github_api.html">
<link title="Datakit_github_vfs" rel="Chapter" href="Datakit_github_vfs.html">
<link title="Datakit_ci" rel="Chapter" href="Datakit_ci.html"><link title="Computation Terms" rel="Section" href="#term">
<link title="Datakit Connection" rel="Section" href="#1_DatakitConnection">
<link title="GitHub Integration" rel="Section" href="#1_GitHubIntegration">
<title>Datakit_ci.Term</title>
</head>
<body>
<div class="navbar"><a class="pre" href="Datakit_ci.Target.html" title="Datakit_ci.Target">Previous</a>
&nbsp;<a class="up" href="Datakit_ci.html" title="Datakit_ci">Up</a>
&nbsp;<a class="post" href="Datakit_ci.ACL.html" title="Datakit_ci.ACL">Next</a>
</div>
<h1>Module <a href="type_Datakit_ci.Term.html">Datakit_ci.Term</a></h1>

<pre><span class="keyword">module</span> Term: <code class="code"><span class="keyword">sig</span></code> <a href="Datakit_ci.Term.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><hr width="100%">
<br>
<h1 id="term">Computation Terms</h1>
<p>

      A term is a unit of computation, which can have various state
      and a log output. Terms can be short-lived or long-running.<br>

<pre><span id="TYPEt"><span class="keyword">type</span> <code class="type">'a</code> t</span> </pre>
<div class="info ">
The type for computation terms. A <code class="code"><span class="keywordsign">'</span>a&nbsp;t</code> is a term that
      evaluates to an <code class="code"><span class="keywordsign">'</span>a</code>, fails, or explains what it's waiting
      for.<br>
</div>


<pre><span id="VALreturn"><span class="keyword">val</span> return</span> : <code class="type">'a -> 'a <a href="Datakit_ci.Term.html#TYPEt">t</a></code></pre><div class="info ">
<code class="code">return&nbsp;x</code> is a term that evaluates successfully to <code class="code">x</code>.<br>
</div>

<pre><span id="VALfail"><span class="keyword">val</span> fail</span> : <code class="type">('a, Format.formatter, unit, 'b <a href="Datakit_ci.Term.html#TYPEt">t</a>) Pervasives.format4 -> 'a</code></pre><div class="info ">
<code class="code">fail&nbsp;fmt</code> is a term that fails with message <code class="code">fmt</code>.<br>
</div>

<pre><span id="VALpending"><span class="keyword">val</span> pending</span> : <code class="type">('a, Format.formatter, unit, 'b <a href="Datakit_ci.Term.html#TYPEt">t</a>) Pervasives.format4 -> 'a</code></pre><div class="info ">
<code class="code">pending&nbsp;fmt</code> is a term that reports it is waiting because of
      reason <code class="code">fmt</code>.<br>
</div>

<pre><span id="VALstate"><span class="keyword">val</span> state</span> : <code class="type">'a <a href="Datakit_ci.Term.html#TYPEt">t</a> -><br>       ('a, [ `Failure of string | `Pending of string ]) Pervasives.result<br>       <a href="Datakit_ci.Term.html#TYPEt">t</a></code></pre><div class="info ">
<code class="code">state&nbsp;x</code> immediately and successfully returns the current state
      of <code class="code">x</code>.<br>
</div>

<pre><span id="VALof_state"><span class="keyword">val</span> of_state</span> : <code class="type">('a, [< `Failure of string | `Pending of string ]) Pervasives.result -><br>       'a <a href="Datakit_ci.Term.html#TYPEt">t</a></code></pre><div class="info ">
<code class="code">of_state&nbsp;x</code> is a term which evaluates to <code class="code">x</code>.<br>
</div>

<pre><span id="VALcatch"><span class="keyword">val</span> catch</span> : <code class="type">'a <a href="Datakit_ci.Term.html#TYPEt">t</a> -><br>       ('a, [ `Failure of string ]) Pervasives.result <a href="Datakit_ci.Term.html#TYPEt">t</a></code></pre><div class="info ">
<code class="code">catch&nbsp;x</code> successfully returns a result showing whether <code class="code">x</code>
      succeeded or failed.<br>
</div>

<pre><span id="VALof_lwt_quick"><span class="keyword">val</span> of_lwt_quick</span> : <code class="type">'a Lwt.t -> 'a <a href="Datakit_ci.Term.html#TYPEt">t</a></code></pre><div class="info ">
<code class="code">of_lwt_quick&nbsp;x</code> evaluates to the result of <code class="code">x</code>. Note that the
      result is never pending, so this is only for quick
      operations.<br>
</div>

<pre><span id="VALof_lwt_slow"><span class="keyword">val</span> of_lwt_slow</span> : <code class="type">(unit -> 'a <a href="Datakit_ci.html#TYPEstatus">Datakit_ci.status</a> Lwt.t) -> 'a <a href="Datakit_ci.Term.html#TYPEt">t</a></code></pre><div class="info ">
<code class="code">of_lwt_slow&nbsp;check</code> is a term that evaluates <code class="code">check&nbsp;()</code> to get
      the current status.  If <code class="code"><span class="constructor">Error</span>&nbsp;(<span class="keywordsign">`</span><span class="constructor">Pending</span>&nbsp;(message,&nbsp;ready))</code>,
      another check is scheduled when <code class="code">ready</code> terminates.<br>
</div>

<pre><span id="VALjoin"><span class="keyword">val</span> join</span> : <code class="type">'a <a href="Datakit_ci.Term.html#TYPEt">t</a> <a href="Datakit_ci.Term.html#TYPEt">t</a> -> 'a <a href="Datakit_ci.Term.html#TYPEt">t</a></code></pre><div class="info ">
<code class="code">join&nbsp;tt</code> is the term to which <code class="code">tt</code> evaluates.<br>
</div>

<pre><span id="VALpair"><span class="keyword">val</span> pair</span> : <code class="type">'a <a href="Datakit_ci.Term.html#TYPEt">t</a> -> 'b <a href="Datakit_ci.Term.html#TYPEt">t</a> -> ('a * 'b) <a href="Datakit_ci.Term.html#TYPEt">t</a></code></pre><div class="info ">
<code class="code">pair&nbsp;a&nbsp;b</code> evaluates to the pair of the results of successfully
      evaluating <code class="code">a</code> and <code class="code">b</code> (in parallel). If <code class="code">a</code> is not successful,
      the result is the same as <code class="code">a</code>. Otherwise, if <code class="code">b</code> is not
      successful then the result is the same as <code class="code">b</code>.<br>
</div>

<pre><span id="VALwithout_logs"><span class="keyword">val</span> without_logs</span> : <code class="type">'a <a href="Datakit_ci.Term.html#TYPEt">t</a> -> 'a <a href="Datakit_ci.Term.html#TYPEt">t</a></code></pre><div class="info ">
<code class="code">without_logs&nbsp;t</code> evaluates to the same result as <code class="code">t</code>, but does
      not link to its logs. This is useful if <code class="code">t</code>'s logs are already
      being reported as part of another job.<br>
</div>

<pre><span class="keyword">module</span> <a href="Datakit_ci.Term.Infix.html">Infix</a>: <code class="code"><span class="keyword">sig</span></code> <a href="Datakit_ci.Term.Infix.html">..</a> <code class="code"><span class="keyword">end</span></code></pre>
<pre><span id="VALlist_map_p"><span class="keyword">val</span> list_map_p</span> : <code class="type">('a -> 'b <a href="Datakit_ci.Term.html#TYPEt">t</a>) -> 'a list -> 'b list <a href="Datakit_ci.Term.html#TYPEt">t</a></code></pre><div class="info ">
<code class="code">list_map_p&nbsp;fn&nbsp;l</code> will map the <code class="code">l</code> list of terms to <code class="code">fn</code> in
      parallel and return the result list when all of them have
      completed.<br>
</div>

<pre><span id="VALwait_for"><span class="keyword">val</span> wait_for</span> : <code class="type">'a <a href="Datakit_ci.Term.html#TYPEt">t</a> -><br>       while_pending:string -> on_failure:string -> unit <a href="Datakit_ci.Term.html#TYPEt">t</a></code></pre><div class="info ">
<code class="code">wait_for&nbsp;t&nbsp;~while_pending&nbsp;~on_failure</code> evaluates successfully
      to unit if <code class="code">t</code> evaluates successfully. It is pending with reason
      <code class="code">while_pending</code> while <code class="code">t</code> is pending, and fails with error
      <code class="code">on_failure</code> if <code class="code">t</code> fails.  This is useful in the case where one
      test case depends on another, to avoid reporting the same status
      twice. Consider wrapping with <code class="code">without_logs</code> if <code class="code">t</code>'s logs will
      be reported as part of another job.<br>
</div>

<pre><span id="VALwait_for_all"><span class="keyword">val</span> wait_for_all</span> : <code class="type">(string * 'a <a href="Datakit_ci.Term.html#TYPEt">t</a>) list -> unit <a href="Datakit_ci.Term.html#TYPEt">t</a></code></pre><div class="info ">
<code class="code">wait_for_all&nbsp;xs</code> evaluates successfully to unit if all terms in
      the assoc list <code class="code">xs</code> evaluate successfully. Otherwise, it is
      pending or failed with a suitable message, based on the names of
      the terms it is waiting for.  Consider wrapping with
      <code class="code">without_logs</code> if <code class="code">xs</code>'s logs will be reported as part of
      another job.<br>
</div>

<pre><span id="VALjob_id"><span class="keyword">val</span> job_id</span> : <code class="type"><a href="Datakit_ci.html#TYPEjob_id">Datakit_ci.job_id</a> <a href="Datakit_ci.Term.html#TYPEt">t</a></code></pre><div class="info ">
<code class="code">job_id</code> evaluates to the ID of the worker that evaluates the
      term. This is useful for logging.<br>
</div>
<br>
<h1 id="1_DatakitConnection">Datakit Connection</h1><br>

<pre><span id="VALdk"><span class="keyword">val</span> dk</span> : <code class="type">(unit -> Datakit_ci.DK.t Lwt.t) <a href="Datakit_ci.Term.html#TYPEt">t</a></code></pre><div class="info ">
<code class="code">dk</code> is a function for getting the current DataKit
      connection.<br>
</div>
<br>
<h1 id="1_GitHubIntegration">GitHub Integration</h1><br>

<pre><span id="VALtarget"><span class="keyword">val</span> target</span> : <code class="type"><a href="Datakit_ci.Target.html#TYPEt">Datakit_ci.Target.t</a> -> <a href="Datakit_ci.Target.html#TYPEv">Datakit_ci.Target.v</a> <a href="Datakit_ci.Term.html#TYPEt">t</a></code></pre><div class="info ">
<code class="code">target&nbsp;id</code> evaluates to the full metadata of the named
      target.<br>
</div>

<pre><span id="VALhead"><span class="keyword">val</span> head</span> : <code class="type"><a href="Datakit_ci.Target.html#TYPEt">Datakit_ci.Target.t</a> -> <a href="Datakit_github.Commit.html#TYPEt">Datakit_github.Commit.t</a> <a href="Datakit_ci.Term.html#TYPEt">t</a></code></pre><div class="info ">
<code class="code">head&nbsp;target</code> evaluates to the commit at the head <code class="code">target</code>.<br>
</div>

<pre><span id="VALbranch_head"><span class="keyword">val</span> branch_head</span> : <code class="type"><a href="Datakit_github.Repo.html#TYPEt">Datakit_github.Repo.t</a> -> string -> <a href="Datakit_github.Commit.html#TYPEt">Datakit_github.Commit.t</a> <a href="Datakit_ci.Term.html#TYPEt">t</a></code></pre><div class="info ">
<code class="code">branch_head&nbsp;repo&nbsp;b</code> evaluates to the commit at the head of
      branch <code class="code">b</code> in the repository <code class="code">repo</code>.<br>
</div>

<pre><span id="VALtag"><span class="keyword">val</span> tag</span> : <code class="type"><a href="Datakit_github.Repo.html#TYPEt">Datakit_github.Repo.t</a> -> string -> <a href="Datakit_github.Commit.html#TYPEt">Datakit_github.Commit.t</a> <a href="Datakit_ci.Term.html#TYPEt">t</a></code></pre><div class="info ">
<code class="code">tag&nbsp;repo&nbsp;t</code> evaluates to the commit of tag <code class="code">t</code> in the
      repository <code class="code">repo</code>.<br>
</div>

<pre><span id="VALci_status"><span class="keyword">val</span> ci_status</span> : <code class="type">string list -><br>       <a href="Datakit_ci.Target.html#TYPEt">Datakit_ci.Target.t</a> -><br>       [ `Error | `Failure | `Pending | `Success ] option <a href="Datakit_ci.Term.html#TYPEt">t</a></code></pre><div class="info ">
<code class="code">ci_status&nbsp;ci&nbsp;target</code> is the status reported by CI <code class="code">ci</code> for
      <code class="code">target</code>.  Note that even if the CI is e.g. pending, this
      returns a successful result with the value <code class="code"><span class="keywordsign">`</span><span class="constructor">Pending</span></code>, not a
      pending result.<br>
</div>

<pre><span id="VALci_target_url"><span class="keyword">val</span> ci_target_url</span> : <code class="type">string list -> <a href="Datakit_ci.Target.html#TYPEt">Datakit_ci.Target.t</a> -> Uri.t option <a href="Datakit_ci.Term.html#TYPEt">t</a></code></pre><div class="info ">
<code class="code">ci_target_url&nbsp;ci&nbsp;target</code> is the target URL reported by CI
      <code class="code">ci</code>.<br>
</div>

<pre><span id="VALci_success_target_url"><span class="keyword">val</span> ci_success_target_url</span> : <code class="type">string list -> <a href="Datakit_ci.Target.html#TYPEt">Datakit_ci.Target.t</a> -> Uri.t <a href="Datakit_ci.Term.html#TYPEt">t</a></code></pre><div class="info ">
<code class="code">ci_success_target_url&nbsp;ci&nbsp;target</code> is the URL of the *successful*
      build <code class="code">ci</code>.  It is pending until a successful URL is
      available.<br>
</div>
</body></html>