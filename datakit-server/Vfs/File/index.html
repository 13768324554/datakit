<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>File (datakit-server.Vfs.File)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="generator" content="doc-ock-html v1.0.0-1-g1fc9bf0"/></head><body><nav id="top"><a href="../index.html">Up</a> &mdash; <span class="package">package <a href="../../index.html">datakit-server</a></span></nav><header><h1><span class="keyword">Module</span> <span class="module-path">Vfs.File</span></h1></header><div class="doc"><p>File operations.</p></div><div class="spec type" id="type-fd"><a href="#type-fd" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>fd</code><code></code><code></code></div><div class="doc"><p>The type for open files, e.g. file descriptors.</p></div></div><div class="spec val" id="val-create_fd"><a href="#val-create_fd" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>create_fd : read:(offset:int64 <span class="keyword">&#8209;&gt;</span> count:int <span class="keyword">&#8209;&gt;</span> Cstruct.t <a href="../index.html#type-or_err">or_err</a>) <span class="keyword">&#8209;&gt;</span> write:(offset:int64 <span class="keyword">&#8209;&gt;</span> Cstruct.t <span class="keyword">&#8209;&gt;</span> unit <a href="../index.html#type-or_err">or_err</a>) <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-fd">fd</a></code></div><div class="doc"><p>Create an open file object.</p></div></div><div class="spec val" id="val-read"><a href="#val-read" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>read : <a href="index.html#type-fd">fd</a> <span class="keyword">&#8209;&gt;</span> offset:int64 <span class="keyword">&#8209;&gt;</span> count:int <span class="keyword">&#8209;&gt;</span> Cstruct.t <a href="../index.html#type-or_err">or_err</a></code></div><div class="doc"><p><code class="code">read f ~offset ~count</code> reads an open file.</p></div></div><div class="spec val" id="val-write"><a href="#val-write" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>write : <a href="index.html#type-fd">fd</a> <span class="keyword">&#8209;&gt;</span> offset:int64 <span class="keyword">&#8209;&gt;</span> Cstruct.t <span class="keyword">&#8209;&gt;</span> unit <a href="../index.html#type-or_err">or_err</a></code></div><div class="doc"><p><code class="code">write f ~offset</code> writes in a open file.</p></div></div><div class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>t</code><code></code><code></code></div><div class="doc"><p>The type for files.</p></div></div><div class="spec val" id="val-pp"><a href="#val-pp" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>pp : <a href="index.html#type-t">t</a> Fmt.t</code></div><div class="doc"><p><code class="code">pp</code> is the pretty-printer for files.</p></div></div><div class="spec val" id="val-create"><a href="#val-create" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>create : stat:(unit <span class="keyword">&#8209;&gt;</span> <a href="../index.html#type-metadata">metadata</a> <a href="../index.html#type-or_err">or_err</a>) <span class="keyword">&#8209;&gt;</span> open_:(unit <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-fd">fd</a> <a href="../index.html#type-or_err">or_err</a>) <span class="keyword">&#8209;&gt;</span> remove:(unit <span class="keyword">&#8209;&gt;</span> unit <a href="../index.html#type-or_err">or_err</a>) <span class="keyword">&#8209;&gt;</span> truncate:(int64 <span class="keyword">&#8209;&gt;</span> unit <a href="../index.html#type-or_err">or_err</a>) <span class="keyword">&#8209;&gt;</span> chmod:(<a href="../index.html#type-perm">perm</a> <span class="keyword">&#8209;&gt;</span> unit <a href="../index.html#type-or_err">or_err</a>) <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">create</code> is the file <code class="code">t</code> such that FIXME.</p></div></div><div class="spec val" id="val-stat"><a href="#val-stat" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>stat : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="../index.html#type-metadata">metadata</a> <a href="../index.html#type-or_err">or_err</a></code></div><div class="doc"><p><code class="code">stat t</code> is <code class="code">t</code>'s metadata.</p></div></div><div class="spec val" id="val-size"><a href="#val-size" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>size : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> int64 <a href="../index.html#type-or_err">or_err</a></code></div><div class="doc"><p><code class="code">size t</code> is <code class="code">t</code>'s size.</p></div></div><div class="spec val" id="val-open_"><a href="#val-open_" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>open_ : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-fd">fd</a> <a href="../index.html#type-or_err">or_err</a></code></div><div class="doc"><p><code class="code">open_ t</code> if a file-descriptor for <code class="code">t</code>.</p></div></div><div class="spec val" id="val-remove"><a href="#val-remove" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>remove : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> unit <a href="../index.html#type-or_err">or_err</a></code></div><div class="doc"><p><code class="code">remove t</code> removes <code class="code">t</code>.</p></div></div><div class="spec val" id="val-truncate"><a href="#val-truncate" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>truncate : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> int64 <span class="keyword">&#8209;&gt;</span> unit <a href="../index.html#type-or_err">or_err</a></code></div><div class="doc"><p><code class="code">truncate t len</code> sets the length of <code class="code">t</code> to <code class="code">len</code>. If the new
length is shorter, the file is truncated. If longer, it is
padded with zeroes.</p></div></div><div class="spec val" id="val-chmod"><a href="#val-chmod" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>chmod : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="../index.html#type-perm">perm</a> <span class="keyword">&#8209;&gt;</span> unit <a href="../index.html#type-or_err">or_err</a></code></div><div class="doc"><p><code class="code">chmod t mode</code> changes the mode of <code class="code">t</code>.</p></div></div><h2>Basic constructors</h2><div class="spec val" id="val-ro_of_string"><a href="#val-ro_of_string" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>ro_of_string : ?&#8288;perm:<a href="../index.html#type-perm">perm</a> <span class="keyword">&#8209;&gt;</span> string <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">ro_of_string s</code> is the static file containing <code class="code">s</code>.</p></div></div><div class="spec val" id="val-rw_of_string"><a href="#val-rw_of_string" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>rw_of_string : string <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a><span class="keyword"> * </span>(unit <span class="keyword">&#8209;&gt;</span> string)</code></div><div class="doc"><p><code class="code">rw_of_string init</code> is a mutable file that initially contains
<code class="code">init</code> and a function which can be called to get the current
contents.</p></div></div><div class="spec val" id="val-status"><a href="#val-status" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>status : ?&#8288;length:(unit <span class="keyword">&#8209;&gt;</span> int Lwt.t) <span class="keyword">&#8209;&gt;</span> (unit <span class="keyword">&#8209;&gt;</span> string Lwt.t) <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">status f</code> is the file containing the result of <code class="code">f</code>. <code class="code">f</code> is
evaluated everytime the file is open. If <code class="code">length</code> is not set,
<code class="code">f</code> will also be called during <code class="code">stat</code> queries.</p></div></div><div class="spec val" id="val-command"><a href="#val-command" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>command : ?&#8288;init:string <span class="keyword">&#8209;&gt;</span> (string <span class="keyword">&#8209;&gt;</span> string <a href="../index.html#type-or_err">or_err</a>) <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">command ?init f</code> is the file containing the result of <code class="code">f</code>. <code class="code">f</code>
is evaluated on every write, with the contents of the file as
argument. Initially the file contains <code class="code">init</code>.</p></div></div><h2>K/V stores.</h2><div class="spec val" id="val-of_kv"><a href="#val-of_kv" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>of_kv : read:(unit <span class="keyword">&#8209;&gt;</span> Cstruct.t option <a href="../index.html#type-or_err">or_err</a>) <span class="keyword">&#8209;&gt;</span> write:(Cstruct.t <span class="keyword">&#8209;&gt;</span> unit <a href="../index.html#type-or_err">or_err</a>) <span class="keyword">&#8209;&gt;</span> stat:(unit <span class="keyword">&#8209;&gt;</span> <a href="../index.html#type-metadata">metadata</a> <a href="../index.html#type-or_err">or_err</a>) <span class="keyword">&#8209;&gt;</span> remove:(unit <span class="keyword">&#8209;&gt;</span> unit <a href="../index.html#type-or_err">or_err</a>) <span class="keyword">&#8209;&gt;</span> chmod:(<a href="../index.html#type-perm">perm</a> <span class="keyword">&#8209;&gt;</span> unit <a href="../index.html#type-or_err">or_err</a>) <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">of_kv ~read ~write ~remove ~stat</code> interprets values from a k/v
store as files. Handles reading and writing regions of the
file.</p></div></div><div class="spec val" id="val-of_kvro"><a href="#val-of_kvro" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>of_kvro : read:(unit <span class="keyword">&#8209;&gt;</span> Cstruct.t option <a href="../index.html#type-or_err">or_err</a>) <span class="keyword">&#8209;&gt;</span> stat:(unit <span class="keyword">&#8209;&gt;</span> <a href="../index.html#type-metadata">metadata</a> <a href="../index.html#type-or_err">or_err</a>) <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">of_kvro</code> is similar to <a href="index.html#val-of_kv">of_kv</a> but for read-only
values.</p></div></div><div class="spec val" id="val-stat_of"><a href="#val-stat_of" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>stat_of : read:(unit <span class="keyword">&#8209;&gt;</span> Cstruct.t option <a href="../index.html#type-or_err">or_err</a>) <span class="keyword">&#8209;&gt;</span> unit <span class="keyword">&#8209;&gt;</span> <a href="../index.html#type-metadata">metadata</a> <a href="../index.html#type-or_err">or_err</a></code></div><div class="doc"><p><code class="code">stat_of ~read</code> makes a <code class="code">stat</code> function from <code class="code">read</code>. The
function reads the file to get the length, and reports the type
as <code class="code">`Normal</code>.</p></div></div><h2>Streams</h2><div class="spec module" id="module-Stream"><a href="#module-Stream" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Stream/index.html">Stream</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="doc"></div></div><div class="spec val" id="val-of_stream"><a href="#val-of_stream" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>of_stream : (unit <span class="keyword">&#8209;&gt;</span> <a href="Stream/index.html#type-t">Stream.t</a> Lwt.t) <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">of_stream s</code> is the file which will be, once opened, similar to
the stream <code class="code">s ()</code>.</p></div></div><h2>Errors</h2><div class="spec val" id="val-err_no_entry"><a href="#val-err_no_entry" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>err_no_entry : <span class="type-var">'a</span> <a href="../index.html#type-or_err">or_err</a></code></div><div class="doc"></div></div><div class="spec val" id="val-err_read_only"><a href="#val-err_read_only" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>err_read_only : <span class="type-var">'a</span> <a href="../index.html#type-or_err">or_err</a></code></div><div class="doc"></div></div></body></html>