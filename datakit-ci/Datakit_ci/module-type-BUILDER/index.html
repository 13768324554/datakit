<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>BUILDER (datakit-ci.Datakit_ci.BUILDER)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="generator" content="doc-ock-html v1.0.0-1-g1fc9bf0"/></head><body><nav id="top"><a href="../index.html">Up</a> &mdash; <span class="package">package <a href="../../index.html">datakit-ci</a></span></nav><header><h1><span class="keyword">Module type</span> <span class="module-path">Datakit_ci.BUILDER</span></h1></header><h2>Builder</h2><div class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>t</code><code></code><code></code></div><div class="doc"><p>The type for builder values. A builder generates values from
inputs (keys). A builder is typically used with a
<a href="../Cache/index.html">cache</a>.</p></div></div><div class="spec module" id="module-Key"><a href="#module-Key" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Key/index.html">Key</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="doc"><p>Input describing what is to be built.
Any change to the key will trigger a rebuild. If you want to use
some value in the build but not rebuild when it changes, put it
in the <code class="code">context</code> instead.</p></div></div><div class="spec type" id="type-context"><a href="#type-context" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>context</code><code></code><code></code></div><div class="doc"><p>For passing context parameters to the builder which aren't part
of the key (e.g. timeouts or resource pools).</p></div></div><div class="spec type" id="type-value"><a href="#type-value" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>value</code><code></code><code></code></div><div class="doc"><p>Output of the builder.</p></div></div><div class="spec val" id="val-name"><a href="#val-name" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>name : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> string</code></div><div class="doc"><p>A unique name for this builder. This is used for metric
reporting.</p></div></div><div class="spec val" id="val-title"><a href="#val-title" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>title : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="Key/index.html#type-t">Key.t</a> <span class="keyword">&#8209;&gt;</span> string</code></div><div class="doc"><p><code class="code">title t key</code> is a one-line summary of the operation that is
performed by <code class="code">generate</code>. It is used as the reason string for
the pending state and as the title of the log.</p></div></div><div class="spec val" id="val-generate"><a href="#val-generate" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>generate : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> switch:Lwt_switch.t <span class="keyword">&#8209;&gt;</span> log:<a href="../Live_log/index.html#type-t">Live_log.t</a> <span class="keyword">&#8209;&gt;</span> <a href="../DK/Transaction/index.html#type-t">DK.Transaction.t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-context">context</a> <span class="keyword">&#8209;&gt;</span> <a href="Key/index.html#type-t">Key.t</a> <span class="keyword">&#8209;&gt;</span> (<a href="index.html#type-value">value</a>, [ `Failure of string ]) Pervasives.result Lwt.t</code></div><div class="doc"><p><code class="code">generate t ~log trans ctx key</code> generates the value for <code class="code">key</code>
and stores it in <code class="code">trans</code> under the &quot;value&quot; directory. It is
called when the value is not in the cache, or when a rebuild has
been requested. The value returned must be the same as the value
that would be loaded by <code class="code">load</code>. If the build is cancelled,
<code class="code">switch</code> will be turned off. If <code class="code">generate</code> throws an exception
then it is caught and treated as an error result.</p></div></div><div class="spec val" id="val-load"><a href="#val-load" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>load : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="../DK/Tree/index.html#type-t">DK.Tree.t</a> <span class="keyword">&#8209;&gt;</span> <a href="Key/index.html#type-t">Key.t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-value">value</a> Lwt.t</code></div><div class="doc"><p><code class="code">load t tr key</code> is the value <code class="code">v</code> previously saved by
<code class="code">generate</code>.</p></div></div><div class="spec val" id="val-branch"><a href="#val-branch" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>branch : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="Key/index.html#type-t">Key.t</a> <span class="keyword">&#8209;&gt;</span> string</code></div><div class="doc"><p>The name of the DataKit branch on which to store the result for
this key. If the branch exists and is up-to-date then we use
that instead of rebuilding. Changes to the key *must* result in
a different branch name.</p></div></div></body></html>