<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Web (datakit-ci.Datakit_ci.Web)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="generator" content="doc-ock-html v1.0.0-1-g1fc9bf0"/></head><body><nav id="top"><a href="../index.html">Up</a> &mdash; <span class="package">package <a href="../../index.html">datakit-ci</a></span></nav><header><h1><span class="keyword">Module</span> <span class="module-path">Datakit_ci.Web</span></h1></header><h2 id="web" class="anchored"><a href="#web" class="anchor"></a>Web Configuration</h2><div class="spec type" id="type-config"><a href="#type-config" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>config</code><code></code><code></code></div><div class="doc"><p>The type for web configuration.</p></div></div><div class="spec val" id="val-config"><a href="#val-config" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>config : ?&#8288;name:string <span class="keyword">&#8209;&gt;</span> ?&#8288;state_repo:Uri.t <span class="keyword">&#8209;&gt;</span> ?&#8288;metrics_token:[ `SHA256 of string ] <span class="keyword">&#8209;&gt;</span> ?&#8288;listen_addr:[ `HTTP of int | `HTTPS of int ] <span class="keyword">&#8209;&gt;</span> ?&#8288;github_scopes_needed:Github_t.scope list <span class="keyword">&#8209;&gt;</span> can_read:<a href="../ACL/index.html#type-t">ACL.t</a> <span class="keyword">&#8209;&gt;</span> can_build:<a href="../ACL/index.html#type-t">ACL.t</a> <span class="keyword">&#8209;&gt;</span> unit <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-config">config</a></code></div><div class="doc"><p><code class="code">config ~name ~state_repo ~can_read ~can_build ()</code> is a web
configuration. If <code class="code">name</code> is given, it is used as the main
heading, and also as the name of the session cookie (useful if
you run multiple CIs on the same host, on different ports). If
<code class="code">state_repo</code> is given, it is used to construct links to the
state repository on GitHub. If <code class="code">metrics_token</code> is <code class="code">Some
      (`SHA256 expected)</code> given then doing an HTTP GET on <code class="code">/metrics</code>
with an Authorization header containing &quot;Bearer TTT&quot; will return
Prometheus-format metrics if sha256(TTT) = expected. There is no
rate limiting, so pick a long <code class="code">token</code>.
<code class="code">github_scopes_needed</code> should be <code class="code">`Read_org; `Public_repo</code> to check whether
users can access a public repository, or <code class="code">`Read_org, `Repo</code> to check
access to private repos. Unfortunately, the GitHub API requires us to
ask for far more permissions than we need.</p></div></div></body></html>