<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Term (datakit-ci.Datakit_ci.Term)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="generator" content="doc-ock-html v1.0.0-1-g1fc9bf0"/></head><body><nav id="top"><a href="../index.html">Up</a> &mdash; <span class="package">package <a href="../../index.html">datakit-ci</a></span></nav><header><h1><span class="keyword">Module</span> <span class="module-path">Datakit_ci.Term</span></h1></header><h2 id="term" class="anchored"><a href="#term" class="anchor"></a>Computation Terms</h2><p>A term is a unit of computation, which can have various state
and a log output. Terms can be short-lived or long-running.</p><div class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>'a t</code><code></code><code></code></div><div class="doc"><p>The type for computation terms. A <code class="code">'a t</code> is a term that
evaluates to an <code class="code">'a</code>, fails, or explains what it's waiting
for.</p></div></div><div class="spec val" id="val-return"><a href="#val-return" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>return : <span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">return x</code> is a term that evaluates successfully to <code class="code">x</code>.</p></div></div><div class="spec val" id="val-fail"><a href="#val-fail" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>fail : (<span class="type-var">'a</span>, Format.formatter, unit, <span class="type-var">'b</span> <a href="index.html#type-t">t</a>) Pervasives.format4 <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span></code></div><div class="doc"><p><code class="code">fail fmt</code> is a term that fails with message <code class="code">fmt</code>.</p></div></div><div class="spec val" id="val-pending"><a href="#val-pending" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>pending : (<span class="type-var">'a</span>, Format.formatter, unit, <span class="type-var">'b</span> <a href="index.html#type-t">t</a>) Pervasives.format4 <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span></code></div><div class="doc"><p><code class="code">pending fmt</code> is a term that reports it is waiting because of
reason <code class="code">fmt</code>.</p></div></div><div class="spec val" id="val-state"><a href="#val-state" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>state : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'a</span>, [ `Pending of string | `Failure of string ]) Pervasives.result <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">state x</code> immediately and successfully returns the current state
of <code class="code">x</code>.</p></div></div><div class="spec val" id="val-of_state"><a href="#val-of_state" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>of_state : (<span class="type-var">'a</span>, [&lt; `Pending of string | `Failure of string ]) Pervasives.result <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">of_state x</code> is a term which evaluates to <code class="code">x</code>.</p></div></div><div class="spec val" id="val-catch"><a href="#val-catch" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>catch : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'a</span>, [ `Failure of string ]) Pervasives.result <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">catch x</code> successfully returns a result showing whether <code class="code">x</code>
succeeded or failed.</p></div></div><div class="spec val" id="val-of_lwt_quick"><a href="#val-of_lwt_quick" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>of_lwt_quick : <span class="type-var">'a</span> Lwt.t <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">of_lwt_quick x</code> evaluates to the result of <code class="code">x</code>. Note that the
result is never pending, so this is only for quick
operations.</p></div></div><div class="spec val" id="val-of_lwt_slow"><a href="#val-of_lwt_slow" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>of_lwt_slow : (unit <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <a href="../index.html#type-status">status</a> Lwt.t) <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">of_lwt_slow check</code> is a term that evaluates <code class="code">check ()</code> to get
the current status. If <code class="code">Error (`Pending (message, ready))</code>,
another check is scheduled when <code class="code">ready</code> terminates.</p></div></div><div class="spec val" id="val-join"><a href="#val-join" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>join : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">join tt</code> is the term to which <code class="code">tt</code> evaluates.</p></div></div><div class="spec val" id="val-pair"><a href="#val-pair" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>pair : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'b</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> (<span class="type-var">'a</span><span class="keyword"> * </span><span class="type-var">'b</span>) <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">pair a b</code> evaluates to the pair of the results of successfully
evaluating <code class="code">a</code> and <code class="code">b</code> (in parallel). If <code class="code">a</code> is not successful,
the result is the same as <code class="code">a</code>. Otherwise, if <code class="code">b</code> is not
successful then the result is the same as <code class="code">b</code>.</p></div></div><div class="spec val" id="val-without_logs"><a href="#val-without_logs" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>without_logs : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">without_logs t</code> evaluates to the same result as <code class="code">t</code>, but does
not link to its logs. This is useful if <code class="code">t</code>'s logs are already
being reported as part of another job.</p></div></div><div class="spec module" id="module-Infix"><a href="#module-Infix" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Infix/index.html">Infix</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="doc"></div></div><div class="spec val" id="val-list_map_p"><a href="#val-list_map_p" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>list_map_p : (<span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'b</span> <a href="index.html#type-t">t</a>) <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> list <span class="keyword">&#8209;&gt;</span> <span class="type-var">'b</span> list <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">list_map_p fn l</code> will map the <code class="code">l</code> list of terms to <code class="code">fn</code> in
parallel and return the result list when all of them have
completed.</p></div></div><div class="spec val" id="val-wait_for"><a href="#val-wait_for" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>wait_for : <span class="type-var">'a</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> while_pending:string <span class="keyword">&#8209;&gt;</span> on_failure:string <span class="keyword">&#8209;&gt;</span> unit <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">wait_for t ~while_pending ~on_failure</code> evaluates successfully
to unit if <code class="code">t</code> evaluates successfully. It is pending with reason
<code class="code">while_pending</code> while <code class="code">t</code> is pending, and fails with error
<code class="code">on_failure</code> if <code class="code">t</code> fails. This is useful in the case where one
test case depends on another, to avoid reporting the same status
twice. Consider wrapping with <code class="code">without_logs</code> if <code class="code">t</code>'s logs will
be reported as part of another job.</p></div></div><div class="spec val" id="val-wait_for_all"><a href="#val-wait_for_all" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>wait_for_all : (string<span class="keyword"> * </span><span class="type-var">'a</span> <a href="index.html#type-t">t</a>) list <span class="keyword">&#8209;&gt;</span> unit <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">wait_for_all xs</code> evaluates successfully to unit if all terms in
the assoc list <code class="code">xs</code> evaluate successfully. Otherwise, it is
pending or failed with a suitable message, based on the names of
the terms it is waiting for. Consider wrapping with
<code class="code">without_logs</code> if <code class="code">xs</code>'s logs will be reported as part of
another job.</p></div></div><div class="spec val" id="val-job_id"><a href="#val-job_id" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>job_id : <a href="../index.html#type-job_id">job_id</a> <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">job_id</code> evaluates to the ID of the worker that evaluates the
term. This is useful for logging.</p></div></div><h2>Datakit Connection</h2><div class="spec val" id="val-dk"><a href="#val-dk" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>dk : (unit <span class="keyword">&#8209;&gt;</span> <a href="../index.html#module-DK">DK</a>.t Lwt.t) <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">dk</code> is a function for getting the current DataKit
connection.</p></div></div><h2>GitHub Integration</h2><div class="spec val" id="val-target"><a href="#val-target" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>target : <a href="../Target/index.html#type-t">Target.t</a> <span class="keyword">&#8209;&gt;</span> <a href="../Target/index.html#type-v">Target.v</a> <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">target id</code> evaluates to the full metadata of the named
target.</p></div></div><div class="spec val" id="val-head"><a href="#val-head" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>head : <a href="../Target/index.html#type-t">Target.t</a> <span class="keyword">&#8209;&gt;</span> Datakit_github.Commit.t <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">head target</code> evaluates to the commit at the head <code class="code">target</code>.</p></div></div><div class="spec val" id="val-branch_head"><a href="#val-branch_head" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>branch_head : Datakit_github.Repo.t <span class="keyword">&#8209;&gt;</span> string <span class="keyword">&#8209;&gt;</span> Datakit_github.Commit.t <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">branch_head repo b</code> evaluates to the commit at the head of
branch <code class="code">b</code> in the repository <code class="code">repo</code>.</p></div></div><div class="spec val" id="val-tag"><a href="#val-tag" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>tag : Datakit_github.Repo.t <span class="keyword">&#8209;&gt;</span> string <span class="keyword">&#8209;&gt;</span> Datakit_github.Commit.t <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">tag repo t</code> evaluates to the commit of tag <code class="code">t</code> in the
repository <code class="code">repo</code>.</p></div></div><div class="spec val" id="val-ci_status"><a href="#val-ci_status" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>ci_status : string list <span class="keyword">&#8209;&gt;</span> <a href="../Target/index.html#type-t">Target.t</a> <span class="keyword">&#8209;&gt;</span> [ `Pending | `Success | `Failure | `Error ] option <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">ci_status ci target</code> is the status reported by CI <code class="code">ci</code> for
<code class="code">target</code>. Note that even if the CI is e.g. pending, this
returns a successful result with the value <code class="code">`Pending</code>, not a
pending result.</p></div></div><div class="spec val" id="val-ci_target_url"><a href="#val-ci_target_url" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>ci_target_url : string list <span class="keyword">&#8209;&gt;</span> <a href="../Target/index.html#type-t">Target.t</a> <span class="keyword">&#8209;&gt;</span> Uri.t option <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">ci_target_url ci target</code> is the target URL reported by CI
<code class="code">ci</code>.</p></div></div><div class="spec val" id="val-ci_success_target_url"><a href="#val-ci_success_target_url" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>ci_success_target_url : string list <span class="keyword">&#8209;&gt;</span> <a href="../Target/index.html#type-t">Target.t</a> <span class="keyword">&#8209;&gt;</span> Uri.t <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">ci_success_target_url ci target</code> is the URL of the *successful*
build <code class="code">ci</code>. It is pending until a successful URL is
available.</p></div></div></body></html>