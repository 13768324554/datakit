<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Git (datakit-ci.Datakit_ci.Git)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="generator" content="doc-ock-html v1.0.0-1-g1fc9bf0"/></head><body><nav id="top"><a href="../index.html">Up</a> &mdash; <span class="package">package <a href="../../index.html">datakit-ci</a></span></nav><header><h1><span class="keyword">Module</span> <span class="module-path">Datakit_ci.Git</span></h1></header><h2 id="git" class="anchored"><a href="#git" class="anchor"></a>Git Manipulation</h2><p>The <code class="code">Git</code> plugin provides Git-related combinators. It
defines types for <a href="index.html#type-t">local Git repositories</a>, <a href="index.html#type-commit">Git
commits</a> inside these repositories and <a href="index.html#type-command">shell command</a>
to run on a given checkout.</p><div class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>t</code><code></code><code></code></div><div class="doc"><p>The type for local non-bare git working directory (with a .git
sub-directory).</p></div></div><div class="spec val" id="val-v"><a href="#val-v" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>v : ?&#8288;remote:string <span class="keyword">&#8209;&gt;</span> logs:<a href="../Live_log/index.html#type-manager">Live_log.manager</a> <span class="keyword">&#8209;&gt;</span> string <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">v ~remote ~logs dir</code> is the local Git repository at <code class="code">dir</code>.
If <code class="code">dir</code> does not exist, it is created by <code class="code">git clone remote</code>.
If <code class="code">remote</code> is not given and <code class="code">dir</code> does not exist, an exception
is raised.</p></div></div><div class="spec type" id="type-commit"><a href="#type-commit" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>commit</code><code></code><code></code></div><div class="doc"><p>The type for Git commits.</p></div></div><div class="spec val" id="val-hash"><a href="#val-hash" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>hash : <a href="index.html#type-commit">commit</a> <span class="keyword">&#8209;&gt;</span> string</code></div><div class="doc"><p><code class="code">hash c</code> is <code class="code">c</code>'s hash.</p></div></div><div class="spec val" id="val-is_after"><a href="#val-is_after" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>is_after : old:string <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-commit">commit</a> <span class="keyword">&#8209;&gt;</span> bool Lwt.t</code></div><div class="doc"><p><code class="code">is_after ~old c</code> is true iff <code class="code">old</code> appears in the history of
<code class="code">c</code>.</p></div></div><div class="spec val" id="val-fetch_head"><a href="#val-fetch_head" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>fetch_head : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="../Target/index.html#type-t">Target.t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-commit">commit</a> <a href="../Term/index.html#type-t">Term.t</a></code></div><div class="doc"><p><code class="code">fetch_head t target</code> evaluates to a local branch in <code class="code">t</code> with a
copy of <code class="code">target</code>'s head commit (downloading it first if
needed).</p></div></div><div class="spec val" id="val-with_checkout"><a href="#val-with_checkout" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>with_checkout : log:<a href="../Live_log/index.html#type-t">Live_log.t</a> <span class="keyword">&#8209;&gt;</span> job_id:<a href="../index.html#type-job_id">job_id</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-commit">commit</a> <span class="keyword">&#8209;&gt;</span> (string <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> Lwt.t) <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> Lwt.t</code></div><div class="doc"><p><code class="code">with_checkout ~log ~job_id commit fn</code> is <code class="code">fn path</code>, where <code class="code">path</code>
is the path of a local checkout of <code class="code">commit</code>. <code class="code">path</code> must not be
used after <code class="code">fn</code>'s thread terminates. The directory is locked while
<code class="code">fn</code> runs with <code class="code">job_id</code> displayed to show why it is busy.</p></div></div><div class="spec val" id="val-with_clone"><a href="#val-with_clone" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>with_clone : log:<a href="../Live_log/index.html#type-t">Live_log.t</a> <span class="keyword">&#8209;&gt;</span> job_id:<a href="../index.html#type-job_id">job_id</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-commit">commit</a> <span class="keyword">&#8209;&gt;</span> (string <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> Lwt.t) <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> Lwt.t</code></div><div class="doc"><p><code class="code">with_clone</code> is similar to <code class="code">with_checkout</code> but clones the
repository to a temporary directory first. This means that the
repository does not need to be locked while the callback function
runs.</p></div></div><div class="spec type" id="type-command"><a href="#type-command" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>command</code><code></code><code></code></div><div class="doc"><p>A cache of executions of a shell command.</p></div></div><div class="spec val" id="val-command"><a href="#val-command" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>command : logs:<a href="../Live_log/index.html#type-manager">Live_log.manager</a> <span class="keyword">&#8209;&gt;</span> timeout:float <span class="keyword">&#8209;&gt;</span> label:string <span class="keyword">&#8209;&gt;</span> clone:bool <span class="keyword">&#8209;&gt;</span> string array list <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-command">command</a></code></div><div class="doc"><p><code class="code">command ~logs ~timeout ~label ~clone cmds</code> is a caching executor
of <code class="code">cmds</code>, which caches results in a branch whose name includes
<code class="code">label</code>. The command will be terminated if it exceeds <code class="code">timeout</code>
seconds. If <code class="code">clone</code> is set then <code class="code">with_clone</code> is used rather than
<code class="code">with_checkout</code>. Note: every command must have a unique label!</p></div></div><div class="spec val" id="val-run"><a href="#val-run" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>run : <a href="index.html#type-command">command</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-commit">commit</a> <span class="keyword">&#8209;&gt;</span> unit <a href="../Term/index.html#type-t">Term.t</a></code></div><div class="doc"><p><code class="code">run cmd commit</code> succeeds if running <code class="code">cmd</code> in a checkout of
<code class="code">commit</code> returns an exit status of zero.</p></div></div></body></html>