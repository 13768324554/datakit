<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Make (datakit_bridge_github@datakit.Datakit_github_state.Make)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="generator" content="doc-ock-html v1.0.0-1-g1fc9bf0"/></head><body><nav id="top"><a href="../index.html">Up</a> &mdash; <span class="package">package <a href="../../index.html">datakit_bridge_github@datakit</a></span></nav><header><h1><span class="keyword">Module</span> <span class="module-path">Datakit_github_state.Make</span></h1></header><div class="doc"><p>API State: TODO find a better name?</p></div><h3 class="heading">Parameters</h3><div><div class="spec argument" id="argument-1-API"><a href="#argument-1-API" class="anchor"></a><div class="def argument"><code>API : Datakit_github.API</code></div><div class="doc"></div></div></div><h3 class="heading">Signature</h3><h2>Token</h2><div class="spec type" id="type-token"><a href="#type-token" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>token</code><code></code><code></code></div><div class="doc"><p>The type for state token.</p></div></div><div class="spec val" id="val-token"><a href="#val-token" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>token : <a href="index.html#argument-1-API">API</a>.token <span class="keyword">&#8209;&gt;</span> Datakit_github.Capabilities.t <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-token">token</a></code></div><div class="doc"><p><code class="code">token t c</code> is the token using the GitHub API token <code class="code">t</code> limited
by the capabilities <code class="code">c</code>.</p></div></div><div class="spec val" id="val-capabilities"><a href="#val-capabilities" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>capabilities : <a href="index.html#type-token">token</a> <span class="keyword">&#8209;&gt;</span> Datakit_github.Capabilities.t</code></div><div class="doc"><p><code class="code">capabilities t</code> is the token <code class="code">t</code>'s capabilities.</p></div></div><div class="spec val" id="val-with_capabilities"><a href="#val-with_capabilities" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>with_capabilities : Datakit_github.Capabilities.t <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-token">token</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-token">token</a></code></div><div class="doc"><p><code class="code">with_capabilities c t</code> is <code class="code">t</code> with the capabilities <code class="code">c</code>.</p></div></div><h2>Synchronisation</h2><div class="spec val" id="val-import"><a href="#val-import" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>import : <a href="index.html#type-token">token</a> <span class="keyword">&#8209;&gt;</span> Datakit_github.Snapshot.t <span class="keyword">&#8209;&gt;</span> Datakit_github.Elt.IdSet.t <span class="keyword">&#8209;&gt;</span> Datakit_github.Snapshot.t Lwt.t</code></div><div class="doc"><p><code class="code">import token t r</code> imports the state of GitHub for the elements
in <code class="code">r</code> into <code class="code">t</code>. API calls use the token <code class="code">token</code>.</p></div></div><div class="spec val" id="val-apply"><a href="#val-apply" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>apply : <a href="index.html#type-token">token</a> <span class="keyword">&#8209;&gt;</span> Datakit_github.Diff.t <span class="keyword">&#8209;&gt;</span> unit Lwt.t</code></div><div class="doc"><p><code class="code">apply token d</code> applies the snapshot diff <code class="code">d</code> as a series of
GitHub API calls, using the token <code class="code">token</code>.</p></div></div><h2>Webhooks</h2><div class="spec val" id="val-add_webhooks"><a href="#val-add_webhooks" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>add_webhooks : <a href="index.html#type-token">token</a> <span class="keyword">&#8209;&gt;</span> watch:(Datakit_github.Repo.t <span class="keyword">&#8209;&gt;</span> unit Lwt.t) <span class="keyword">&#8209;&gt;</span> Datakit_github.Repo.Set.t <span class="keyword">&#8209;&gt;</span> unit Lwt.t</code></div><div class="doc"><p><code class="code">add_webhooks t rs</code> adds webhooks for the repositories <code class="code">rs</code>.</p></div></div><div class="spec val" id="val-import_webhook_events"><a href="#val-import_webhook_events" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>import_webhook_events : <a href="index.html#type-token">token</a> <span class="keyword">&#8209;&gt;</span> events:(unit <span class="keyword">&#8209;&gt;</span> Datakit_github.Event.t list Lwt.t) <span class="keyword">&#8209;&gt;</span> Datakit_github.Snapshot.t <span class="keyword">&#8209;&gt;</span> Datakit_github.Snapshot.t Lwt.t</code></div><div class="doc"><p><code class="code">import_webhook_events t ~events s</code> applies <code class="code">events ()</code> on top
of <code class="code">s</code>. Note: it ensure that all the metadata are correctly
updated by inserting (possibly) missing events in the mix. For
instance, GitHub never sends <span class="xref-unresolved" title="unresolved reference to &quot;Event.Status&quot;">status</span> events, so
<code class="code">import_events</code> has to reconstruct them.</p></div></div></body></html>