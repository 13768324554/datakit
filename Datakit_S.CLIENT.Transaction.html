<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="Start" href="index.html">
<link rel="previous" href="Datakit_S.CLIENT.Commit.html">
<link rel="next" href="Datakit_S.CLIENT.Branch.html">
<link rel="Up" href="Datakit_S.CLIENT.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Index of module types" rel=Appendix href="index_module_types.html">
<link title="Vfs" rel="Chapter" href="Vfs.html">
<link title="Fs9p" rel="Chapter" href="Fs9p.html">
<link title="Datakit_path" rel="Chapter" href="Datakit_path.html">
<link title="Datakit_S" rel="Chapter" href="Datakit_S.html">
<link title="Datakit_client_9p" rel="Chapter" href="Datakit_client_9p.html">
<link title="Ivfs" rel="Chapter" href="Ivfs.html">
<link title="Ivfs_tree" rel="Chapter" href="Ivfs_tree.html">
<link title="Ivfs_remote" rel="Chapter" href="Ivfs_remote.html">
<link title="Ivfs_blob" rel="Chapter" href="Ivfs_blob.html">
<link title="Datakit_github" rel="Chapter" href="Datakit_github.html">
<link title="Datakit_github_api" rel="Chapter" href="Datakit_github_api.html">
<link title="Datakit_github_vfs" rel="Chapter" href="Datakit_github_vfs.html">
<link title="Datakit_ci" rel="Chapter" href="Datakit_ci.html"><link title="Reading" rel="Section" href="#2_Reading">
<link title="Writing" rel="Section" href="#2_Writing">
<link title="Finishing" rel="Section" href="#2_Finishing">
<link title="Merging and history" rel="Section" href="#2_Mergingandhistory">
<title>Datakit_S.CLIENT.Transaction</title>
</head>
<body>
<div class="navbar"><a class="pre" href="Datakit_S.CLIENT.Commit.html" title="Datakit_S.CLIENT.Commit">Previous</a>
&nbsp;<a class="up" href="Datakit_S.CLIENT.html" title="Datakit_S.CLIENT">Up</a>
&nbsp;<a class="post" href="Datakit_S.CLIENT.Branch.html" title="Datakit_S.CLIENT.Branch">Next</a>
</div>
<h1>Module <a href="type_Datakit_S.CLIENT.Transaction.html">Datakit_S.CLIENT.Transaction</a></h1>

<pre><span class="keyword">module</span> Transaction: <code class="code"><span class="keyword">sig</span></code> <a href="Datakit_S.CLIENT.Transaction.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><hr width="100%">
<br>
All changes to a branch are made in transactions. When a
        transaction is committed, it is merged with the current
        contents of the branch.<br>
<br>
<h2 id="2_Reading">Reading</h2><br>

<pre><span class="keyword">include</span> <a href="Datakit_S.READABLE_TREE.html">Datakit_S.READABLE_TREE</a></pre>
<br>
<h2 id="2_Writing">Writing</h2><br>

<pre><span id="VALcreate_dir"><span class="keyword">val</span> create_dir</span> : <code class="type"><a href="Datakit_S.CLIENT.html#TYPEt">Datakit_S.CLIENT.t</a> -> <a href="Datakit_path.html#TYPEt">Datakit_path.t</a> -> unit <a href="Datakit_S.CLIENT.html#TYPEor_error">Datakit_S.CLIENT.or_error</a> Lwt.t</code></pre><div class="info ">
<code class="code">create_dir&nbsp;t&nbsp;path</code> creates the directory <code class="code">path</code>.<br>
</div>

<pre><span id="VALcreate_file"><span class="keyword">val</span> create_file</span> : <code class="type"><a href="Datakit_S.CLIENT.html#TYPEt">Datakit_S.CLIENT.t</a> -><br>       <a href="Datakit_path.html#TYPEt">Datakit_path.t</a> -><br>       ?executable:bool -> Cstruct.t -> unit <a href="Datakit_S.CLIENT.html#TYPEor_error">Datakit_S.CLIENT.or_error</a> Lwt.t</code></pre><div class="info ">
<code class="code">create_file&nbsp;t&nbsp;path&nbsp;?executable&nbsp;content</code> creates the file
        <code class="code">path</code>.<br>
</div>

<pre><span id="VALcreate_symlink"><span class="keyword">val</span> create_symlink</span> : <code class="type"><a href="Datakit_S.CLIENT.html#TYPEt">Datakit_S.CLIENT.t</a> -><br>       <a href="Datakit_path.html#TYPEt">Datakit_path.t</a> -> string -> unit <a href="Datakit_S.CLIENT.html#TYPEor_error">Datakit_S.CLIENT.or_error</a> Lwt.t</code></pre><div class="info ">
<code class="code">create_symlink&nbsp;t&nbsp;path&nbsp;target</code> creates the symlink <code class="code">path</code>.<br>
</div>

<pre><span id="VALreplace_file"><span class="keyword">val</span> replace_file</span> : <code class="type"><a href="Datakit_S.CLIENT.html#TYPEt">Datakit_S.CLIENT.t</a> -><br>       <a href="Datakit_path.html#TYPEt">Datakit_path.t</a> -> Cstruct.t -> unit <a href="Datakit_S.CLIENT.html#TYPEor_error">Datakit_S.CLIENT.or_error</a> Lwt.t</code></pre><div class="info ">
<code class="code">replace_file&nbsp;t&nbsp;path&nbsp;new_content</code> changes the content of
        the existing file <code class="code">path</code>.<br>
</div>

<pre><span id="VALcreate_or_replace_file"><span class="keyword">val</span> create_or_replace_file</span> : <code class="type"><a href="Datakit_S.CLIENT.html#TYPEt">Datakit_S.CLIENT.t</a> -><br>       <a href="Datakit_path.html#TYPEt">Datakit_path.t</a> -> Cstruct.t -> unit <a href="Datakit_S.CLIENT.html#TYPEor_error">Datakit_S.CLIENT.or_error</a> Lwt.t</code></pre><div class="info ">
<code class="code">create_or_replace_file&nbsp;t&nbsp;path&nbsp;content</code> uses either <code class="code">create_file</code>
        or <code class="code">replace_file</code> as appropriate to set the contents.<br>
</div>

<pre><span id="VALset_executable"><span class="keyword">val</span> set_executable</span> : <code class="type"><a href="Datakit_S.CLIENT.html#TYPEt">Datakit_S.CLIENT.t</a> -><br>       <a href="Datakit_path.html#TYPEt">Datakit_path.t</a> -> bool -> unit <a href="Datakit_S.CLIENT.html#TYPEor_error">Datakit_S.CLIENT.or_error</a> Lwt.t</code></pre><div class="info ">
<code class="code">set_executable&nbsp;t&nbsp;path&nbsp;flag</code> marks the file at <code class="code">path</code> as
        executable or not.<br>
</div>

<pre><span id="VALremove"><span class="keyword">val</span> remove</span> : <code class="type"><a href="Datakit_S.CLIENT.html#TYPEt">Datakit_S.CLIENT.t</a> -> <a href="Datakit_path.html#TYPEt">Datakit_path.t</a> -> unit <a href="Datakit_S.CLIENT.html#TYPEor_error">Datakit_S.CLIENT.or_error</a> Lwt.t</code></pre><div class="info ">
<code class="code">remove&nbsp;t&nbsp;path</code> removes <code class="code">path</code>. If <code class="code">path</code> is a directory then
        the entire subtree is removed.<br>
</div>

<pre><span id="VALrename"><span class="keyword">val</span> rename</span> : <code class="type"><a href="Datakit_S.CLIENT.html#TYPEt">Datakit_S.CLIENT.t</a> -><br>       <a href="Datakit_path.html#TYPEt">Datakit_path.t</a> -> string -> unit <a href="Datakit_S.CLIENT.html#TYPEor_error">Datakit_S.CLIENT.or_error</a> Lwt.t</code></pre><div class="info ">
<code class="code">rename&nbsp;t&nbsp;path&nbsp;new_name</code> changes the basename of <code class="code">path</code> to
        <code class="code">new_name</code>.  Note: it is only possible to rename within a
        directory (this is a 9p limitation).<br>
</div>

<pre><span id="VALtruncate"><span class="keyword">val</span> truncate</span> : <code class="type"><a href="Datakit_S.CLIENT.html#TYPEt">Datakit_S.CLIENT.t</a> -><br>       <a href="Datakit_path.html#TYPEt">Datakit_path.t</a> -> int64 -> unit <a href="Datakit_S.CLIENT.html#TYPEor_error">Datakit_S.CLIENT.or_error</a> Lwt.t</code></pre><div class="info ">
<code class="code">truncate&nbsp;t&nbsp;path&nbsp;length</code> sets the length of the file at <code class="code">path</code>
        to <code class="code">length</code>.  If <code class="code">length</code> is longer than the current length,
        the file is padded with zero bytes.<br>
</div>

<pre><span id="VALmake_dirs"><span class="keyword">val</span> make_dirs</span> : <code class="type"><a href="Datakit_S.CLIENT.html#TYPEt">Datakit_S.CLIENT.t</a> -> <a href="Datakit_path.html#TYPEt">Datakit_path.t</a> -> unit <a href="Datakit_S.CLIENT.html#TYPEor_error">Datakit_S.CLIENT.or_error</a> Lwt.t</code></pre><div class="info ">
<code class="code">make_dirs&nbsp;t&nbsp;path</code> ensures that <code class="code">path</code> exists and is a
        directory, creating it and any missing parents as
        necessary.<br>
</div>
<br>
<h2 id="2_Finishing">Finishing</h2><br>

<pre><span id="VALcommit"><span class="keyword">val</span> commit</span> : <code class="type"><a href="Datakit_S.CLIENT.html#TYPEt">Datakit_S.CLIENT.t</a> -> message:string -> unit <a href="Datakit_S.CLIENT.html#TYPEor_error">Datakit_S.CLIENT.or_error</a> Lwt.t</code></pre><div class="info ">
<code class="code">commit&nbsp;t&nbsp;~message</code> creates a new commit with the given log
        message and the current contents of the transaction and then
        merges it into the branch from which the transaction was
        created.  The transaction cannot be used after calling
        this.<br>
</div>

<pre><span id="VALabort"><span class="keyword">val</span> abort</span> : <code class="type"><a href="Datakit_S.CLIENT.html#TYPEt">Datakit_S.CLIENT.t</a> -> unit Lwt.t</code></pre><div class="info ">
<code class="code">abort&nbsp;t</code> aborts the transaction without committing it.  The
        transaction cannot be used after calling this.<br>
</div>
<br>
<h2 id="2_Mergingandhistory">Merging and history</h2><br>

<pre><code><span id="TYPEmerge_inputs"><span class="keyword">type</span> <code class="type"></code>merge_inputs</span> = {</code></pre><table class="typetable">
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTmerge_inputs.ours">ours</span>&nbsp;: <code class="type">Datakit_S.CLIENT.Tree.t</code>;</code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTmerge_inputs.theirs">theirs</span>&nbsp;: <code class="type">Datakit_S.CLIENT.Tree.t</code>;</code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code>&nbsp;&nbsp;</code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTmerge_inputs.base">base</span>&nbsp;: <code class="type">Datakit_S.CLIENT.Tree.t</code>;</code></td>

</tr></table>
}

<div class="info ">
When performing a merge, these three directories can be used
        to calculate the final result.  <code class="code">ours</code> is the previous
        contents of the transaction, <code class="code">theirs</code> is the commit being
        merged and <code class="code">base</code> is a least common ancestor. If there is no
        common ancestor then <code class="code">base</code> is an empty tree.<br>
</div>


<pre><span id="VALmerge"><span class="keyword">val</span> merge</span> : <code class="type"><a href="Datakit_S.CLIENT.html#TYPEt">Datakit_S.CLIENT.t</a> -><br>       <a href="Datakit_S.CLIENT.Commit.html#TYPEt">Datakit_S.CLIENT.Commit.t</a> -><br>       (<a href="Datakit_S.CLIENT.Transaction.html#TYPEmerge_inputs">merge_inputs</a> * <a href="Datakit_path.html#TYPEt">Datakit_path.t</a> list)<br>       <a href="Datakit_S.CLIENT.html#TYPEor_error">Datakit_S.CLIENT.or_error</a> Lwt.t</code></pre><div class="info ">
<code class="code">merge&nbsp;t&nbsp;commit</code> merges <code class="code">commit</code> into the transaction. It
        performs any trivial merges it can and returns <code class="code">(merge_inputs,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;conflicts)</code> to allow you to resolve the remaining ones. You
        must write to each path in <code class="code">conflicts</code> at least once before
        you can commit the transaction.  You may perform multiple
        merges in one transaction, but the <code class="code">merge_inputs</code> returned is
        only valid until the start of the next merge.<br>
</div>

<pre><span id="VALparents"><span class="keyword">val</span> parents</span> : <code class="type"><a href="Datakit_S.CLIENT.html#TYPEt">Datakit_S.CLIENT.t</a> -><br>       <a href="Datakit_S.CLIENT.Commit.html#TYPEt">Datakit_S.CLIENT.Commit.t</a> list <a href="Datakit_S.CLIENT.html#TYPEor_error">Datakit_S.CLIENT.or_error</a> Lwt.t</code></pre><div class="info ">
<code class="code">parents&nbsp;t</code> is the parents of the transaction (that is, the parents of
        the commit that would be generated if you committed now.<br>
</div>

<pre><span id="VALset_parents"><span class="keyword">val</span> set_parents</span> : <code class="type"><a href="Datakit_S.CLIENT.html#TYPEt">Datakit_S.CLIENT.t</a> -><br>       <a href="Datakit_S.CLIENT.Commit.html#TYPEt">Datakit_S.CLIENT.Commit.t</a> list -> unit <a href="Datakit_S.CLIENT.html#TYPEor_error">Datakit_S.CLIENT.or_error</a> Lwt.t</code></pre><div class="info ">
<code class="code">set_parents&nbsp;t&nbsp;new_parents</code> replaces the current list of
        parents.  Note that this does not perform a merge - it only
        affects the metadata.  Note also that <code class="code">merge</code> automatically
        updates the parents, so it is not necessary to call it
        manually in that case.<br>
</div>

<pre><span id="VALconflicts"><span class="keyword">val</span> conflicts</span> : <code class="type"><a href="Datakit_S.CLIENT.html#TYPEt">Datakit_S.CLIENT.t</a> -> <a href="Datakit_path.html#TYPEt">Datakit_path.t</a> list <a href="Datakit_S.CLIENT.html#TYPEor_error">Datakit_S.CLIENT.or_error</a> Lwt.t</code></pre><div class="info ">
<code class="code">conflicts&nbsp;t</code> returns the current list of paths that had merge
        conflicts and have not been written to since.  It is not
        possible to commit while this is non-empty.<br>
</div>

<pre><span id="VALdiff"><span class="keyword">val</span> diff</span> : <code class="type"><a href="Datakit_S.CLIENT.html#TYPEt">Datakit_S.CLIENT.t</a> -><br>       <a href="Datakit_S.CLIENT.Commit.html#TYPEt">Datakit_S.CLIENT.Commit.t</a> -><br>       <a href="Datakit_path.html#TYPEt">Datakit_path.t</a> <a href="Datakit_S.html#TYPEdiff">Datakit_S.diff</a> list <a href="Datakit_S.CLIENT.html#TYPEor_error">Datakit_S.CLIENT.or_error</a> Lwt.t</code></pre><div class="info ">
<code class="code">diff&nbsp;t&nbsp;c</code> returns the paths differences between <code class="code">c</code> and <code class="code">t</code>'s
        head.<br>
</div>

<pre><span id="VALclosed"><span class="keyword">val</span> closed</span> : <code class="type"><a href="Datakit_S.CLIENT.html#TYPEt">Datakit_S.CLIENT.t</a> -> bool</code></pre><div class="info ">
<code class="code">closed&nbsp;t</code> is true if <code class="code">t</code> is closed and thus it is not valid
        to read/write on it anymore.<br>
</div>
</body></html>