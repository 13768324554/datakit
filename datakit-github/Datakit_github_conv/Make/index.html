<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Make (datakit-github.Datakit_github_conv.Make)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="generator" content="doc-ock-html v1.0.0-1-g1fc9bf0"/></head><body><nav id="top"><a href="../index.html">Up</a> &mdash; <span class="package">package <a href="../../index.html">datakit-github</a></span></nav><header><h1><span class="keyword">Module</span> <span class="module-path">Datakit_github_conv.Make</span></h1></header><div class="doc"><p>Conversion between GitHub and DataKit states.</p></div><h3 class="heading">Parameters</h3><div><div class="spec argument" id="argument-1-DK"><a href="#argument-1-DK" class="anchor"></a><div class="def argument"><code><a href="argument-1-DK/index.html">DK</a> : <a href="../../../datakit-client/Datakit_client/index.html#module-type-S">Datakit_client.S</a></code></div><div class="doc"></div></div></div><h3 class="heading">Signature</h3><div class="spec type" id="type-tree"><a href="#type-tree" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>tree</code><code><span class="keyword"> = </span><a href="argument-1-DK/Tree/index.html#type-t">DK.Tree.t</a></code><code></code></div><div class="doc"><p>The type for trees.</p></div></div><h2>Repositories</h2><div class="spec val" id="val-repos"><a href="#val-repos" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>repos : <a href="index.html#type-tree">tree</a> <span class="keyword">&#8209;&gt;</span> <a href="../../Datakit_github/Repo/index.html#module-Set">Datakit_github.Repo.Set</a>.t Lwt.t</code></div><div class="doc"><p><code class="code">repos t</code> is the list of repositories stored in <code class="code">t</code>.</p></div></div><h2>Status</h2><div class="spec val" id="val-statuses"><a href="#val-statuses" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>statuses : ?&#8288;commits:<a href="../../Datakit_github/Commit/index.html#module-Set">Datakit_github.Commit.Set</a>.t <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-tree">tree</a> <span class="keyword">&#8209;&gt;</span> <a href="../../Datakit_github/Status/index.html#module-Set">Datakit_github.Status.Set</a>.t Lwt.t</code></div><div class="doc"><p><code class="code">statuses t</code> is the list of status stored in <code class="code">t</code>.</p></div></div><h2>Pull requests</h2><div class="spec val" id="val-prs"><a href="#val-prs" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>prs : ?&#8288;repos:<a href="../../Datakit_github/Repo/index.html#module-Set">Datakit_github.Repo.Set</a>.t <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-tree">tree</a> <span class="keyword">&#8209;&gt;</span> <a href="../../Datakit_github/PR/index.html#module-Set">Datakit_github.PR.Set</a>.t Lwt.t</code></div><div class="doc"><p><code class="code">prs t</code> is the list of pull requests stored in <code class="code">t</code>.</p></div></div><h2>Git References</h2><div class="spec val" id="val-refs"><a href="#val-refs" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>refs : ?&#8288;repos:<a href="../../Datakit_github/Repo/index.html#module-Set">Datakit_github.Repo.Set</a>.t <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-tree">tree</a> <span class="keyword">&#8209;&gt;</span> <a href="../../Datakit_github/Ref/index.html#module-Set">Datakit_github.Ref.Set</a>.t Lwt.t</code></div><div class="doc"><p><code class="code">refs t</code> is the list of Git references stored in <code class="code">t</code>.</p></div></div><h2>Elements</h2><div class="spec val" id="val-find"><a href="#val-find" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>find : <a href="index.html#type-tree">tree</a> <span class="keyword">&#8209;&gt;</span> <a href="../../Datakit_github/Elt/index.html#type-id">Datakit_github.Elt.id</a> <span class="keyword">&#8209;&gt;</span> <a href="../../Datakit_github/Elt/index.html#type-t">Datakit_github.Elt.t</a> option Lwt.t</code></div><div class="doc"><p><code class="code">find t id</code> is the elements with ID <code class="code">id</code> in <code class="code">t</code>.</p></div></div><div class="spec val" id="val-pr"><a href="#val-pr" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>pr : <a href="index.html#type-tree">tree</a> <span class="keyword">&#8209;&gt;</span> <a href="../../Datakit_github/PR/index.html#type-id">Datakit_github.PR.id</a> <span class="keyword">&#8209;&gt;</span> <a href="../../Datakit_github/PR/index.html#type-t">Datakit_github.PR.t</a> option Lwt.t</code></div><div class="doc"><p><code class="code">pr t id</code> is the pull-request with ID <code class="code">id</code>.</p></div></div><div class="spec val" id="val-ref"><a href="#val-ref" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>ref : <a href="index.html#type-tree">tree</a> <span class="keyword">&#8209;&gt;</span> <a href="../../Datakit_github/Ref/index.html#type-id">Datakit_github.Ref.id</a> <span class="keyword">&#8209;&gt;</span> <a href="../../Datakit_github/Ref/index.html#type-t">Datakit_github.Ref.t</a> option Lwt.t</code></div><div class="doc"><p><code class="code">ref t id</code> is the Git reference with ID <code class="code">id</code>.</p></div></div><div class="spec val" id="val-status"><a href="#val-status" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>status : <a href="index.html#type-tree">tree</a> <span class="keyword">&#8209;&gt;</span> <a href="../../Datakit_github/Status/index.html#type-id">Datakit_github.Status.id</a> <span class="keyword">&#8209;&gt;</span> <a href="../../Datakit_github/Status/index.html#type-t">Datakit_github.Status.t</a> option Lwt.t</code></div><div class="doc"><p><code class="code">status t id</code> is the build status with ID <code class="code">id</code>.</p></div></div><h2>Updates</h2><div class="spec val" id="val-update_elt"><a href="#val-update_elt" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>update_elt : <a href="argument-1-DK/Transaction/index.html#type-t">DK.Transaction.t</a> <span class="keyword">&#8209;&gt;</span> <a href="../../Datakit_github/Elt/index.html#type-t">Datakit_github.Elt.t</a> <span class="keyword">&#8209;&gt;</span> unit Lwt.t</code></div><div class="doc"><p><code class="code">update_elt t e</code> updates the element <code class="code">e</code> in the transaction
<code class="code">t</code>.</p></div></div><div class="spec val" id="val-remove_elt"><a href="#val-remove_elt" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>remove_elt : <a href="argument-1-DK/Transaction/index.html#type-t">DK.Transaction.t</a> <span class="keyword">&#8209;&gt;</span> <a href="../../Datakit_github/Elt/index.html#type-id">Datakit_github.Elt.id</a> <span class="keyword">&#8209;&gt;</span> unit Lwt.t</code></div><div class="doc"><p><code class="code">remove_elt t e</code> removes the element <code class="code">e</code> in the transaction
<code class="code">t</code>.</p></div></div><div class="spec val" id="val-update_event"><a href="#val-update_event" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>update_event : <a href="argument-1-DK/Transaction/index.html#type-t">DK.Transaction.t</a> <span class="keyword">&#8209;&gt;</span> <a href="../../Datakit_github/Event/index.html#type-t">Datakit_github.Event.t</a> <span class="keyword">&#8209;&gt;</span> unit Lwt.t</code></div><div class="doc"><p><code class="code">update_event t e</code> applies the (webhook) event <code class="code">e</code> to the
transaction <code class="code">t</code>.</p></div></div><h2>Dirty</h2><div class="spec type" id="type-dirty"><a href="#type-dirty" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>dirty</code><code><span class="keyword"> = </span><a href="../../Datakit_github/Elt/index.html#module-IdSet">Datakit_github.Elt.IdSet</a>.t</code><code></code></div><div class="doc"><p>The type for dirty elements.</p></div></div><div class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>t</code><code></code><code></code></div><div class="doc"><p>The type for filesystem snapshots.</p></div></div><div class="spec val" id="val-stain"><a href="#val-stain" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>stain : <a href="argument-1-DK/Transaction/index.html#type-t">DK.Transaction.t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-dirty">dirty</a> <span class="keyword">&#8209;&gt;</span> unit Lwt.t</code></div><div class="doc"><p><code class="code">stain tr d</code> makes all the elements in <code class="code">d</code> dirty.</p></div></div><div class="spec val" id="val-clean"><a href="#val-clean" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>clean : <a href="argument-1-DK/Transaction/index.html#type-t">DK.Transaction.t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-dirty">dirty</a> <span class="keyword">&#8209;&gt;</span> unit Lwt.t</code></div><div class="doc"><p><code class="code">clean t d</code> removes <code class="code">d</code> from the list of dirty elements in
<code class="code">t</code>.</p></div></div><div class="spec val" id="val-dirty"><a href="#val-dirty" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>dirty : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-dirty">dirty</a></code></div><div class="doc"><p><code class="code">dirty t</code> is the collection of dirty elements in <code class="code">t</code>.</p></div></div><h2>Snapshots and diffs</h2><div class="spec val" id="val-snapshot"><a href="#val-snapshot" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>snapshot : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="../../Datakit_github/Snapshot/index.html#type-t">Datakit_github.Snapshot.t</a></code></div><div class="doc"><p><code class="code">snapshot t</code> is <code class="code">t</code>'s in-memory snapshot.</p></div></div><div class="spec val" id="val-head"><a href="#val-head" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>head : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="argument-1-DK/Commit/index.html#type-t">DK.Commit.t</a></code></div><div class="doc"><p><code class="code">head t</code> is <code class="code">t</code>'s head.</p></div></div><div class="spec val" id="val-pp"><a href="#val-pp" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>pp : <a href="index.html#type-t">t</a> Fmt.t</code></div><div class="doc"><p><code class="code">pp</code> is the pretty-printer for <a href="index.html#val-snapshot">snapshot</a> values.</p></div></div><div class="spec val" id="val-diff"><a href="#val-diff" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>diff : <a href="argument-1-DK/Commit/index.html#type-t">DK.Commit.t</a> <span class="keyword">&#8209;&gt;</span> <a href="argument-1-DK/Commit/index.html#type-t">DK.Commit.t</a> <span class="keyword">&#8209;&gt;</span> (<a href="../../Datakit_github/Diff/index.html#type-t">Datakit_github.Diff.t</a><span class="keyword"> * </span><a href="index.html#type-dirty">dirty</a>) Lwt.t</code></div><div class="doc"><p><code class="code">diff x y</code> computes the difference between the commits <code class="code">x</code> and
<code class="code">y</code>.</p></div></div><div class="spec val" id="val-of_branch"><a href="#val-of_branch" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>of_branch : debug:string <span class="keyword">&#8209;&gt;</span> ?&#8288;old:<a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="argument-1-DK/Branch/index.html#type-t">DK.Branch.t</a> <span class="keyword">&#8209;&gt;</span> (<a href="argument-1-DK/Transaction/index.html#type-t">DK.Transaction.t</a><span class="keyword"> * </span><a href="index.html#type-t">t</a>) Lwt.t</code></div><div class="doc"><p><code class="code">snapshot dbg ?old b</code> is a pair <code class="code">(t, s)</code> where <code class="code">s</code> is a snapshot
of the branch <code class="code">b</code> and a <code class="code">t</code> is a transaction started on <code class="code">s</code>'s
commit. Note: this is expensive, so try to provide a (recent)
<code class="code">old</code> snapshot if possible. In that case, the difference between
the two snapshot's commits will be computed and only the minimal
number of filesystem access will be performed to compute the new
snapshot by updating the old one.</p></div></div><div class="spec val" id="val-of_commit"><a href="#val-of_commit" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>of_commit : debug:string <span class="keyword">&#8209;&gt;</span> ?&#8288;old:<a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="argument-1-DK/Commit/index.html#type-t">DK.Commit.t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> Lwt.t</code></div><div class="doc"><p>Same as <a href="index.html#val-of_branch">of_branch</a> but does not allow to update the underlying
store.</p></div></div><div class="spec val" id="val-apply"><a href="#val-apply" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>apply : debug:string <span class="keyword">&#8209;&gt;</span> <a href="../../Datakit_github/Diff/index.html#type-t">Datakit_github.Diff.t</a> <span class="keyword">&#8209;&gt;</span> <a href="argument-1-DK/Transaction/index.html#type-t">DK.Transaction.t</a> <span class="keyword">&#8209;&gt;</span> bool Lwt.t</code></div><div class="doc"><p><code class="code">apply d t</code> applies the snapshot diff <code class="code">d</code> into the datakit
transaction <code class="code">t</code>. Returns <code class="code">true</code> iff the undelying datakit state
has changed.</p></div></div></body></html>